{% load i18n %}
{% load static %}

<style>

  nav.navbar{

    padding: 0;
    height:80px;
    z-index:10;
  }


  .dropdown-toggle.lang::after{
    display: none;
    margin: 0;
    content: none;
    border: none;
    vertical-align: none  ;

}


  .dropdown-toggle.lang{

    background-color: #b19b6c40;
  }
@media (min-width: 992px) {
  .myc_r_nav {
    flex-grow: 0 !important;
    flex-basis: auto !important;
    width: auto !important;  /* let it shrink/grow based on content */
  }
}

  nav.navbar div a img {
    width: 57px;
    height: 60px;
    border-radius: 0;
  }
  nav a {
    text-wrap: nowrap;
  }

  .theme-toggle {
  width: 124px;
  height: 48px;
  border-radius: 8px;
  background: linear-gradient(90deg, #f5862c, #f5b932);
  display: flex;
  align-items: center;
  padding: 4px;
  cursor: pointer;
  position: relative;
  transition: background 0.3s ease;
}

.theme-toggle .theme-icon {
  background: white;
  border-radius: 8px;
  width:72px;
  height: 40px;
  display: flex;
  align-items: center;
  justify-content: center;
  transition: transform 0.3s ease;
  color: #f5862c;
  font-size: 16px;
}

.theme-toggle.dark {
  background: linear-gradient(90deg, #2b2b2b, #555);
}

.theme-toggle.dark .theme-icon {
  transform: translateX(41px); /* slide to the right */
  color: rgb(26, 15, 104);
}


{% comment %} CHAT GPT STUFF {% endcomment %}

/* Custom collapse breakpoint at 1150px */
@media (max-width: 1150px) {
  nav a.btn{
    width:180px;
  }


}

@media (max-width: 991px) {
  nav a.btn{
    width:224px;
  }


}


</style>

<nav class="navbar navbar-expand-lg bg-body-tertiary position-relative">
  <div class="container-fluid">

    <!-- LEFT -->
    <div class="d-flex align-items-center order-1">
      <div class="theme-toggle  " id="themeToggle">
        <div class="theme-icon">
          <i class="bi bi-brightness-high"></i>
        </div>
      </div>
    </div>

    <!-- DESKTOP CENTERED LOGO (absolute, only visible lg+) -->
    <div class="d-none d-lg-block position-absolute top-50 start-50 translate-middle">
      <a href="{% url 'website:landing' %}">
        <img src="{{ logo }}" alt="logo" style="width:60px;height:57px;">
      </a>
    </div>

    <!-- RIGHT: Toggler & Menu -->
    <div class="d-flex align-items-center order-3 ms-auto">
      <!-- Navbar toggler (only small screens) -->
      <button class="navbar-toggler" type="button" data-bs-toggle="collapse"
              data-bs-target="#navbarMenu" aria-controls="navbarMenu"
              aria-expanded="false" aria-label="Toggle navigation">
        <span class="navbar-toggler-icon"></span>
      </button>
    </div>

    <!-- Collapsible menu -->
    <div 
    class="collapse navbar-collapse order-4 order-lg-2 justify-content-end" 
    id="navbarMenu"
    style="background: rgba(255, 255, 255, 0.727);"
    
    >
      <ul class="navbar-nav d-flex align-items-lg-center gap-2">
        <!-- Language dropdown -->
        <li class="nav-item dropdown">
          <button class="btn btn-secondary dropdown-toggle lang" type="button"
                  id="langDropdown" data-bs-toggle="dropdown" aria-expanded="false">
            <i class="bi bi-globe"></i>
          </button>
          <ul class="dropdown-menu dropdown-menu-lg-end" aria-labelledby="langDropdown">
            {% get_current_language as CURRENT %}
            {% get_available_languages as LANGS %}
            {% for code, name in LANGS %}
              <li>
                <form id="lang-{{ code }}" action="{% url 'set_language' %}" method="post">
                  {% csrf_token %}
                  <input type="hidden" name="language" value="{{ code }}">
                  <input type="hidden" name="next" value="{{ request.get_full_path }}">
                </form>
                <button 
                    type="submit"
                  class="dropdown-item {% if code == CURRENT %}active{% endif %}"
                  form="lang-{{ code }}">
                  {{ name }}
                </button>
              </li>
            {% endfor %}
          </ul>
        </li>

        {% if user.is_authenticated %}
          <li class="nav-item">
            <form method="post" action="{% url 'website:logout' %}">
              {% csrf_token %}
              <button type="submit" class="btn btn-secondary wide__btn">
                {% trans "Logout" %}
              </button>
            </form>
          </li>
          <div class="nav-item d-flex gap-3"  >

            <small class="text-mutant ">
              {% trans 'Hi ' %}
              {{user.username}} 
            </small>

            <div  style="width: 24px; height: 24px; align-self: center;">
                <style>
                  .mom{
                    display: inline-block;
                    transition: all .4s ease-in-out;
                  }
                  .mom:hover{
                    transform: scale(1.1);
                  }
                </style>
              <a
              class="mom"
              href="{% url 'website:profileview' %}">
                <img src="{% static 'mat/Group.svg' %}"
                style="width: 100%; height: 100%;"
                
                alt="">
              </a>
            </div>
          </div>
        {% else %}
          <li class="nav-item">
            <a href="{% url 'website:signup' %}" class="btn btn-primary wide__btn">
              {% trans "Create Account" %}
            </a>
          </li>
          <li class="nav-item">
            <a href="{% url 'website:login' %}" class="btn btn-secondary wide__btn">
              {% trans "Login" %}
            </a>
          </li>
        {% endif %}
      </ul>
    </div>


    <div class="d-flex d-lg-none flex-grow-1 justify-content-center order-2">
      <a href="{% url 'website:landing' %}">
        <img src="{{ logo }}" alt="logo" style="width:60px;height:57px;">
      </a>
    </div>

  </div>
</nav>

<script>
  document.addEventListener("DOMContentLoaded", function () {
    const toggle = document.getElementById("themeToggle");
    const icon = toggle.querySelector(".theme-icon i");

    toggle.addEventListener("click", function () {
      toggle.classList.toggle("dark");

      if (toggle.classList.contains("dark")) {
        icon.classList.remove("bi-brightness-high");
        icon.classList.add("bi-moon");
        // OPTIONAL: add your dark mode logic here
        document.body.classList.add("dark-mode");
      } else {
        icon.classList.remove("bi-moon");
        icon.classList.add("bi-brightness-high");
        // OPTIONAL: remove dark mode logic
        document.body.classList.remove("dark-mode");
      }
    });
  });
  


  


</script>
<script>
(function () {
  function getCookie(name) {
    let match = document.cookie.match(new RegExp('(^| )' + name + '=([^;]+)'));
    if (match) return match[2];
    return null;
}

  
  
  
  const savedLang = getCookie("django_language");
  const pathLang = window.location.pathname.split("/")[1]; 
    




    if (savedLang && savedLang !== pathLang) {
        const newUrl = window.location.origin + "/" + savedLang + window.location.pathname.substring(3) + window.location.search;
        window.location.replace(newUrl);
    }
})();
</script>
